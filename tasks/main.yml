---
- name: install required packages
  sudo: true
  apt: pkg={{ item }}
  with_items:
  - python-pycurl
  - apt-transport-https

- name: add apt key
  sudo: true
  apt_key: >
    id=0x68576280
    url=https://deb.nodesource.com/gpgkey/nodesource.gpg.key

- name: add apt repositories
  sudo: true
  apt_repository: >
    repo='{{ item }} https://deb.nodesource.com/node_0.10 trusty main'
  with_items:
    - deb
    - deb-src

- name: install package
  sudo: true
  apt: pkg=nodejs

- name: add `./node_modules/.bin` to PATH
  sudo: true
  copy: >
    content='export PATH="./node_modules/.bin:$PATH"'
    dest=/etc/profile.d/nodejs_path.sh
    mode=0644
  when: nodejs.add_node_modules_bin_to_path
